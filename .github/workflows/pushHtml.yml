name: Upload html
on:
  push:
    paths:
      - "html/**"

jobs:
  push_server:
    name: Push html to server
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: SSH Setup
        uses: ./.github/actions/ssh-setup

      - name: Validate required secrets
        shell: bash
        run: |
          echo "Validating secrets..."
          if [ -z "${{ secrets.SSH_USER }}" ]; then
            echo "ERROR: SSH_USER secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.SSH_HOST }}" ]; then
            echo "ERROR: SSH_HOST secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
            echo "ERROR: SSH_PRIVATE_KEY secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.REPO_DIR }}" ]; then
            echo "ERROR: REPO_DIR secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.HTML_DIR }}" ]; then
            echo "WARNING: HTML_DIR secret is not set (optional)"
          fi
          echo "âœ… All required secrets are present"

      - name: Show files to deploy
        shell: bash
        run: |
          echo "ðŸ“‹ HTML files to deploy:"
          find html -type f \
            \( -name "*.html" -o -name "*.ico" -o -name "*.yaml" -o -name "*.yml" \) \
            -not -path "html/.git/*" \
            | sort

      - name: Copy HTML files to server
        shell: bash
        run: scp -r html ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:${{ secrets.REPO_DIR }}/

      - name: SSH Cleanup
        uses: ./.github/actions/ssh-cleanup
