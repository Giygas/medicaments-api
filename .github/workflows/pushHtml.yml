name: Upload html
on:
  push:
    paths:
      - "html/**"

jobs:
  push_server:
    name: Push html to server
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: SSH Setup
        uses: ./.github/actions/ssh-setup

      - name: Validate required secrets
        uses: ./.github/actions/validate-secrets
        with:
          required_secrets: SSH_USER,SSH_HOST,SSH_PRIVATE_KEY,HTML_DIR

      - name: Show files to deploy
        shell: bash
        run: |
          echo "ðŸ“‹ HTML files to deploy:"
          find html -type f \
            \( -name "*.html" -o -name "*.ico" -o -name "*.yaml" -o -name "*.yml" \) \
            -not -path "html/.git/*" \
            | sort

      - name: Copy HTML files to server
        shell: bash
        run: scp -r html ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:${{ secrets.REPO_DIR }}/

      - name: SSH Cleanup
        uses: ./.github/actions/ssh-cleanup
