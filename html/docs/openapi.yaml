openapi: 3.1.0
info:
  title: API M√©dicaments FR
  description: |
    # API RESTful haute performance pour les m√©dicaments fran√ßais
    
    Cette API JSON fournit un acc√®s programmatique aux donn√©es compl√®tes des m√©dicaments fran√ßais
    en parsant de mani√®re concurrente 5 sources de la Base de Donn√©es Publique des M√©dicaments (BDPM).
    
    ## üöÄ Fonctionnalit√©s principales
    
    - **Parsing concurrent** : Traitement parall√®le de 5 fichiers TSV (sp√©cialit√©s, compositions, pr√©sentations, g√©n√©riques, conditions)
    - **Zero-downtime updates** : Mises √† jour atomiques sans interruption de service
    - **Cache intelligent** : HTTP cache avec ETag/Last-Modified et compression gzip
    - **Rate limiting** : Token bucket algorithm avec co√ªts variables par endpoint
    - **Performance** : Recherche O(1) via lookup maps en m√©moire
    
    ## üìä Donn√©es et mises √† jour
    
    - **Source** : [Base de Donn√©es Publique des M√©dicaments](https://base-donnees-publique.medicaments.gouv.fr)
    - **Fr√©quence** : 2 fois par jour (6h00 et 18h00 heure locale)
    - **Volume** : 20K+ m√©dicaments avec donn√©es compl√®tes
    - **Fra√Æcheur** : Monitoring horaire avec alertes si >25h sans mise √† jour
    
    ## üîí Rate Limiting
    
    L'API utilise un syst√®me de limitation de taux par token bucket pour garantir une utilisation √©quitable :
    
    - **Capacit√© initiale** : 1000 tokens par IP
    - **Taux de recharge** : 3 tokens par seconde  
    - **Co√ªts** : 5-200 tokens par requ√™te
    
    ### Co√ªts par endpoint
    | Endpoint | Co√ªt (tokens) | Raison |
    |----------|---------------|--------|
    | `/health` | 5 | Monitoring l√©ger |
    | `/database/{pageNumber}` | 20 | Pagination optimis√©e |
    | `/generiques/{libelle}` | 20 | Recherche de g√©n√©riques |
    | `/generiques/group/{groupId}` | 20 | Lookup par ID |
    | `/medicament/{element}` | 100 | Recherche regex complexe |
    | `/medicament/id/{cis}` | 100 | Lookup individuel |
    | `/database` | 200 | Export complet (~20MB) |
    | Pages statiques | 0 | Documentation et ressources |
    
    ### En-t√™tes de r√©ponse
    - `X-RateLimit-Limit`: Capacit√© maximale de tokens (1000)
    - `X-RateLimit-Remaining`: Tokens restants pour cette IP
    - `X-RateLimit-Rate`: Taux de recharge des tokens (3/sec)
    - `Retry-After`: Temps d'attente recommand√© si limite d√©pass√©e
    
    ## üéØ Performance
    
    - **Temps de r√©ponse** : <50ms (cache hit), <100ms (recherche)
    - **Compression** : gzip activ√© (80% r√©duction de taille)
    - **Cache hit ratio** : >90% avec ETag/Last-Modified
    - **Disponibilit√©** : 99.9% avec graceful shutdown
    
    ## üìã Conformit√©
    
    - **Licence** : AGPL-3.0 pour le logiciel, licence BDPM pour les donn√©es
    - **Source obligatoire** : Mention de base-donnees-publique.medicaments.gouv.fr
    - **Int√©grit√©** : Aucune alt√©ration des donn√©es originales
    - **Usage** : Non-commercial et √©ducatif privil√©gi√©
  version: 1.0.0
  contact:
    name: GitHub Repository
    url: https://github.com/giygas/medicaments-api
  license:
    name: AGPL-3.0
    url: https://www.gnu.org/licenses/agpl-3.0.html
externalDocs:
  description: Base de donn√©es publique des m√©dicaments
  url: https://base-donnees-publique.medicaments.gouv.fr

paths:
  /database:
    get:
      summary: Obtenir tous les m√©dicaments
      description: R√©cup√©rer la liste compl√®te de tous les m√©dicaments dans la base de donn√©es
      tags:
        - M√©dicaments
      x-token-cost: 200
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Medicament'
              example:
                - cis: 61504672
                  elementPharmaceutique: "PARACETAMOL MYLAN 1 g, comprim√©"
                  formePharmaceutique: "comprim√©"
                  voiesAdministration: ["orale"]
                  statusAutorisation: "Autorisation active"
                  typeProcedure: "Proc√©dure nationale"
                  etatComercialisation: "Commercialis√©e"
                  dateAMM: "2000-01-01"
                  titulaire: "MYLAN SAS"
                  surveillanceRenforce: "Non"
                  composition:
                    - cis: 61504672
                      elementPharmaceutique: "parac√©tamol"
                      codeSubstance: 12345
                      denominationSubstance: "PARACETAMOL"
                      dosage: "1,000 g"
                      referenceDosage: "1,000 g"
                      natureComposant: "substance active"
                  generiques:
                    - cis: 61504672
                      group: 1234
                      libelle: "PARACETAMOL 1 g, comprim√©"
                      type: "Princeps"
                  presentation:
                    - cis: 61504672
                      cip7: 1234567
                      libelle: "PARACETAMOL MYLAN 1 g, comprim√© pellicul√©, bo√Æte de 8"
                      statusAdministratif: "Pr√©sentation active"
                      etatComercialisation: "Commercialis√©e"
                      dateDeclaration: "2000-01-01"
                      cip13: 3400912345678
                      agreement: "Oui"
                      tauxRemboursement: "65%"
                      prix: 2.45
                  conditions:
                    - "M√©dicament soumis √† prescription m√©dicale"
                    - "Non remboursable si prescrit hors AMM"
          headers:
            Cache-Control:
              schema:
                type: string
              example: "public, max-age=21600"
              description: Cache HTTP pour 6 heures
            Last-Modified:
              schema:
                type: string
                format: date-time
              example: "2025-01-15T06:00:00Z"
              description: Date de derni√®re mise √† jour des donn√©es
            ETag:
              schema:
                type: string
              example: "\"1736947200\""
              description: Timestamp Unix pour la validation de cache
            X-RateLimit-Limit:
              schema:
                type: string
              example: "1000"
              description: Capacit√© maximale de tokens
            X-RateLimit-Remaining:
              schema:
                type: string
              example: "800"
              description: Tokens restants pour cette IP
            X-RateLimit-Rate:
              schema:
                type: string
              example: "3"
              description: Taux de recharge (tokens/sec)
        '304':
          description: Not modified (client has cached version)
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /database/{pageNumber}:
    get:
      summary: Obtenir les m√©dicaments pagin√©s
      description: R√©cup√©rer les m√©dicaments par pages de 10 √©l√©ments chacune
      tags:
        - M√©dicaments
      x-token-cost: 20
      parameters:
        - name: pageNumber
          in: path
          required: true
          description: Page number (starting from 1)
          schema:
            type: integer
            minimum: 1
          example: 1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Medicament'
                  page:
                    type: integer
                    example: 1
                  pageSize:
                    type: integer
                    example: 10
                  totalItems:
                    type: integer
                    example: 15000
                  maxPage:
                    type: integer
                    example: 1500
          headers:
            Cache-Control:
              schema:
                type: string
              example: "public, max-age=21600"
            Last-Modified:
              schema:
                type: string
                format: date-time
        '400':
          description: Invalid page number
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Page not found (exceeds maximum pages)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /medicament/{element}:
    get:
      summary: Rechercher des m√©dicaments par nom
      description: Rechercher des m√©dicaments par d√©nomination (insensible √† la casse)
      tags:
        - M√©dicaments
      x-token-cost: 100
      parameters:
        - name: element
          in: path
          required: true
          description: Search term (3-50 characters, alphanumeric with spaces)
          schema:
            type: string
            minLength: 3
            maxLength: 50
            pattern: '^[a-zA-Z0-9 ]+$'
          example: "paracetamol"
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/Medicament'
                  count:
                    type: integer
                    example: 5
                    description: Nombre de r√©sultats trouv√©s
              example:
                results:
                  - cis: 61504672
                    elementPharmaceutique: "PARACETAMOL MYLAN 1 g, comprim√©"
                    formePharmaceutique: "comprim√©"
                    voiesAdministration: ["orale"]
                    statusAutorisation: "Autorisation active"
                    typeProcedure: "Proc√©dure nationale"
                    etatComercialisation: "Commercialis√©e"
                    dateAMM: "2000-01-01"
                    titulaire: "MYLAN SAS"
                    surveillanceRenforce: "Non"
                    composition: []
                    generiques: []
                    presentation: []
                    conditions: []
                  - cis: 60001234
                    elementPharmaceutique: "DOLIPRANE 1000 mg, comprim√©"
                    formePharmaceutique: "comprim√©"
                    voiesAdministration: ["orale"]
                    statusAutorisation: "Autorisation active"
                    typeProcedure: "Proc√©dure nationale"
                    etatComercialisation: "Commercialis√©e"
                    dateAMM: "1998-05-15"
                    titulaire: "SANOFI AVENTIS FRANCE"
                    surveillanceRenforce: "Non"
                    composition: []
                    generiques: []
                    presentation: []
                    conditions: []
                count: 2
          headers:
            Cache-Control:
              schema:
                type: string
              example: "public, max-age=3600"
        '400':
          description: Invalid search term
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: No medicaments found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /medicament/id/{cis}:
    get:
      summary: Obtenir un m√©dicament par code CIS
      description: R√©cup√©rer un m√©dicament sp√©cifique par son CIS (Code Identifiant de Sp√©cialit√©)
      tags:
        - M√©dicaments
      x-token-cost: 100
      parameters:
        - name: cis
          in: path
          required: true
          description: CIS code (positive integer less than 1,000,000,000)
          schema:
            type: integer
            minimum: 1
            maximum: 999999999
          example: 61504672
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Medicament'
          headers:
            Cache-Control:
              schema:
                type: string
              example: "public, max-age=43200"
            Last-Modified:
              schema:
                type: string
                format: date-time
        '400':
          description: Invalid CIS code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Medicament not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /generiques/{libelle}:
    get:
      summary: Rechercher des groupes g√©n√©riques par nom
      description: Rechercher des groupes g√©n√©riques par libell√© (insensible √† la casse)
      tags:
        - G√©n√©riques
      x-token-cost: 20
      parameters:
        - name: libelle
          in: path
          required: true
          description: Search term (3-50 characters, alphanumeric with spaces)
          schema:
            type: string
            minLength: 3
            maxLength: 50
            pattern: '^[a-zA-Z0-9 ]+$'
          example: "paracetamol"
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GeneriqueList'
          headers:
            Cache-Control:
              schema:
                type: string
              example: "public, max-age=3600"
        '400':
          description: Invalid search term
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: No generics found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /generiques/group/{groupId}:
    get:
      summary: Obtenir un groupe g√©n√©rique par ID
      description: R√©cup√©rer un groupe g√©n√©rique sp√©cifique par son ID de groupe
      tags:
        - G√©n√©riques
      x-token-cost: 20
      parameters:
        - name: groupId
          in: path
          required: true
          description: Group ID (positive integer less than 100,000)
          schema:
            type: integer
            minimum: 1
            maximum: 99999
          example: 1234
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Generique'
          headers:
            Cache-Control:
              schema:
                type: string
              example: "public, max-age=43200"
            Last-Modified:
              schema:
                type: string
                format: date-time
        '400':
          description: Invalid group ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Generic group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /health:
    get:
      summary: Point de terminaison de v√©rification de sant√©
      description: V√©rifier l'√©tat de sant√© de l'API et de la base de donn√©es
      tags:
        - Syst√®me
      x-token-cost: 5
      responses:
        '200':
          description: Healthy system
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["healthy", "degraded", "unhealthy"]
                    example: "healthy"
                    description: √âtat de sant√© global de l'API
                  uptime_seconds:
                    type: integer
                    example: 86400
                    description: Temps de fonctionnement en secondes
                  uptime_human:
                    type: string
                    example: "1d 2h 30m 45s"
                    description: Temps de fonctionnement au format lisible
                  last_updated:
                    type: string
                    format: date-time
                    example: "2025-01-15T06:00:00Z"
                    description: Date et heure de la derni√®re mise √† jour r√©ussie
                  data:
                    type: object
                    properties:
                      medicament_count:
                        type: integer
                        example: 15420
                        description: Nombre total de m√©dicaments dans la base
                      generique_count:
                        type: integer
                        example: 5200
                        description: Nombre total de groupes g√©n√©riques
                      data_age_hours:
                        type: number
                        format: float
                        example: 2.5
                        description: √Çge des donn√©es en heures depuis la derni√®re mise √† jour
                      next_update:
                        type: string
                        format: date-time
                        example: "2025-01-15T18:00:00Z"
                        description: Prochaine mise √† jour planifi√©e
                    description: Informations sur les donn√©es de l'API
                  system:
                    type: object
                    properties:
                      updating:
                        type: boolean
                        example: false
                        description: Indique si une mise √† jour est en cours
                      memory_usage_mb:
                        type: integer
                        example: 130
                        description: Utilisation m√©moire en MB
                      goroutines:
                        type: integer
                        example: 45
                        description: Nombre de goroutines actives
                    description: Informations syst√®me et performance
                example:
                  status: "healthy"
                  uptime_seconds: 86400
                  uptime_human: "1d 0h 0m 0s"
                  last_updated: "2025-01-15T06:00:00Z"
                  data:
                    medicament_count: 15420
                    generique_count: 5200
                    data_age_hours: 2.5
                    next_update: "2025-01-15T18:00:00Z"
                  system:
                    updating: false
                    memory_usage_mb: 130
                    goroutines: 45
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Medicament:
      type: object
      description: Un m√©dicament avec tous les d√©tails
      properties:
        cis:
          type: integer
          description: Code Identifiant de Sp√©cialit√©
          example: 61504672
        elementPharmaceutique:
          type: string
          description: D√©nomination pharmaceutique
          example: "PARACETAMOL MYLAN 1 g, comprim√©"
        formePharmaceutique:
          type: string
          description: Forme pharmaceutique
          example: "comprim√©"
        voiesAdministration:
          type: array
          items:
            type: string
          description: Voies d'administration
          example: ["orale"]
        statusAutorisation:
          type: string
          description: Statut d'autorisation
          example: "Autorisation active"
        typeProcedure:
          type: string
          description: Type de proc√©dure
          example: "Proc√©dure nationale"
        etatComercialisation:
          type: string
          description: √âtat de commercialisation
          example: "Commercialis√©e"
        dateAMM:
          type: string
          description: Date d'autorisation de mise sur le march√©
          example: "2000-01-01"
        titulaire:
          type: string
          description: Titulaire de l'autorisation
          example: "MYLAN SAS"
        surveillanceRenforce:
          type: string
          description: Surveillance renforc√©e
          example: "Non"
        composition:
          type: array
          items:
            $ref: '#/components/schemas/Composition'
          description: Composition du m√©dicament
        generiques:
          type: array
          items:
            $ref: '#/components/schemas/Generique'
          description: G√©n√©riques associ√©s
        presentation:
          type: array
          items:
            $ref: '#/components/schemas/Presentation'
          description: Pr√©sentations disponibles
        conditions:
          type: array
          items:
            type: string
          description: Conditions de prescription
          example: ["M√©dicament soumis √† prescription m√©dicale"]

    Composition:
      type: object
      description: Composition element of a medicament
      properties:
        cis:
          type: integer
          description: CIS code
          example: 61504672
        elementPharmaceutique:
          type: string
          description: Pharmaceutical element
          example: "parac√©tamol"
        codeSubstance:
          type: integer
          description: Substance code
          example: 12345
        denominationSubstance:
          type: string
          description: Substance denomination
          example: "PARACETAMOL"
        dosage:
          type: string
          description: Dosage
          example: "1,000 g"
        referenceDosage:
          type: string
          description: Reference dosage
          example: "1,000 g"
        natureComposant:
          type: string
          description: Component nature
          example: "substance active"

    Generique:
      type: object
      description: Generic information for a medicament
      properties:
        cis:
          type: integer
          description: CIS code
          example: 61504672
        group:
          type: integer
          description: Generic group ID
          example: 1234
        libelle:
          type: string
          description: Generic group label
          example: "PARACETAMOL 1 g, comprim√©"
        type:
          type: string
          description: Generic type
          example: "Princeps"

    Presentation:
      type: object
      description: Presentation of a medicament
      properties:
        cis:
          type: integer
          description: CIS code
          example: 61504672
        cip7:
          type: integer
          description: CIP-7 code
          example: 1234567
        libelle:
          type: string
          description: Presentation label
          example: "PARACETAMOL MYLAN 1 g, comprim√© pellicul√©, bo√Æte de 8"
        statusAdministratif:
          type: string
          description: Administrative status
          example: "Pr√©sentation active"
        etatComercialisation:
          type: string
          description: Commercialization status
          example: "Commercialis√©e"
        dateDeclaration:
          type: string
          description: Declaration date
          example: "2000-01-01"
        cip13:
          type: integer
          description: CIP-13 code
          example: 3400912345678
        agreement:
          type: string
          description: Agreement status
          example: "Oui"
        tauxRemboursement:
          type: string
          description: Reimbursement rate
          example: "65%"
        prix:
          type: number
          format: float
          description: Price
          example: 2.45

    GeneriqueList:
      type: object
      description: List of medicaments in a generic group
      properties:
        groupID:
          type: integer
          description: Generic group ID
          example: 1234
        libelle:
          type: string
          description: Generic group label
          example: "PARACETAMOL 1 g, comprim√©"
        medicaments:
          type: array
          items:
            $ref: '#/components/schemas/GeneriqueMedicament'
          description: Medicaments in this generic group

    GeneriqueMedicament:
      type: object
      description: Medicament within a generic group
      properties:
        cis:
          type: integer
          description: CIS code
          example: 61504672
        elementPharmaceutique:
          type: string
          description: Pharmaceutical denomination
          example: "PARACETAMOL MYLAN 1 g, comprim√©"
        formePharmaceutique:
          type: string
          description: Pharmaceutical form
          example: "comprim√©"
        type:
          type: string
          description: Generic type
          example: "Princeps"
        composition:
          type: array
          items:
            $ref: '#/components/schemas/GeneriqueComposition'
          description: Composition for generic grouping

    GeneriqueComposition:
      type: object
      description: Composition element for generic grouping
      properties:
        elementPharmaceutique:
          type: string
          description: Pharmaceutical element
          example: "parac√©tamol"
        substance:
          type: string
          description: Substance name
          example: "PARACETAMOL"
        dosage:
          type: string
          description: Dosage
          example: "1,000 g"

    Error:
      type: object
      description: R√©ponse d'erreur
      properties:
        error:
          type: string
          description: Message d'erreur
          example: "Terme de recherche invalide : doit √™tre alphanum√©rique avec espaces, max 50 caract√®res"

tags:
  - name: M√©dicaments
    description: Points de terminaison li√©s aux m√©dicaments
  - name: G√©n√©riques
    description: Points de terminaison des groupes de m√©dicaments g√©n√©riques
  - name: Syst√®me
    description: Points de terminaison de sant√© et d'√©tat du syst√®me
